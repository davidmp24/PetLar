{% extends 'index.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center text-light">Cadastro de Adotante</h2>
    <div class="card p-4 shadow-lg bg-dark text-light">
        <form method="POST" enctype="multipart/form-data">
            <!-- ID do Adotante -->
            <div class="mb-3">
                <label for="adotante_id" class="form-label">ID do Adotante</label>
                <input type="text" class="form-control bg-secondary text-light" id="adotante_id" name="adotante_id" value="{{ proximo_id }}" readonly style="max-width: 100px;">
            </div>
            <!-- Informações Pessoais -->
            <h4 class="text-light">Informações Pessoais</h4>
            <div class="mb-3">
                <label for="nome_completo" class="form-label">Nome Completo</label>
                <input type="text" class="form-control bg-secondary text-light" id="nome_completo" name="nome_completo" required>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="rg" class="form-label">RG</label>
                    <input type="text" class="form-control bg-secondary text-light" id="rg" name="rg" required>
                </div>
                <div class="col-md-6">
                    <label for="cpf" class="form-label">CPF</label>
                    <input type="text" class="form-control bg-secondary text-light" id="cpf" name="cpf" required onblur="validarCPF(this.value)">
                    <div id="cpf-error" class="text-danger"></div>
                </div>
            </div>

            <!-- Informações de Contato -->
            <h4 class="text-light mt-4">Contato</h4>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="cep" class="form-label">CEP</label>
                    <input type="text" class="form-control form-control-sm bg-secondary text-light" id="cep" name="cep" required>
                    <div id="cep-error" class="text-danger"></div>
                </div>
                    <button type="button" class="btn btn-primary w-200" required readonly style="max-width: 200px;" onclick="buscarEndereco(document.getElementById('cep').value)">
                        <i class="fas fa-search"></i> Buscar CEP
                    </button>                                          
            </div>            
            <div class="mb-3">
                <label for="endereco" class="form-label">Endereço</label>
                <input type="text" class="form-control bg-secondary text-light" id="endereco" name="endereco" required>
            </div>
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="bairro" class="form-label">Bairro</label>
                    <input type="text" class="form-control bg-secondary text-light" id="bairro" name="bairro" required>
                </div>
                <div class="col-md-4">
                    <label for="cidade" class="form-label">Cidade</label>
                    <input type="text" class="form-control bg-secondary text-light" id="cidade" name="cidade" required>
                </div>
            </div>
            
             <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control bg-secondary text-light" id="email" name="email" required>
            </div>
            <div class="mb-3">
                <label for="telefone" class="form-label">Telefone</label>
                <input type="text" class="form-control bg-secondary text-light" id="telefone" name="telefone" required>
            </div>

            <!-- Informações sobre Interesse em Adoção -->
            <h4 class="text-light mt-4">Interesse em Adoção</h4>
            <div class="mb-3">
                <label for="animal_interesse" class="form-label">Animal de Interesse (Nome)</label>
                <input type="text" class="form-control bg-secondary text-light" id="animal_interesse" name="animal_interesse" required>
            </div>
            <div class="mb-3">
                <label for="tipo_animal_interesse" class="form-label">Tipo de Animal de Interesse</label>
                <select class="form-select bg-secondary text-light" id="tipo_animal_interesse" name="tipo_animal_interesse" required>
                    <option value="" disabled selected>Selecione</option>
                    <option value="Cachorro">Cachorro</option>
                    <option value="Gato">Gato</option>
                    <option value="Ave">Ave</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="justificativa_adocao" class="form-label">Por que você deseja adotar?</label>
                <textarea class="form-control bg-secondary text-light" id="justificativa_adocao" name="justificativa_adocao" rows="3" required></textarea>
            </div>

            <!-- Questionário (Opcional, mas importante para adoção responsável) -->
            <h4 class="text-light mt-4">Questionário</h4>
            <div class="mb-3">
                <label class="form-label">Você tem outros animais em casa?</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="tem_outros_animais" id="tem_outros_animais_sim" value="Sim" onclick="mostrarCamposAnimais()">
                    <label class="form-check-label" for="tem_outros_animais_sim">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="tem_outros_animais" id="tem_outros_animais_nao" value="Nao" onclick="esconderCamposAnimais()" checked>
                    <label class="form-check-label" for="tem_outros_animais_nao">Não</label>
                </div>
            </div>
    
            <!-- Campos adicionais (inicialmente escondidos) -->
            <div id="campos_animais" style="display: none;">
                <div class="mb-3">
                    <label for="quantidade_animais" class="form-label">Quantidade de animais que você possui</label>
                    <input type="number" class="form-control bg-secondary text-light" id="quantidade_animais" name="quantidade_animais" min="1" placeholder="Ex: 2">
                </div>
                <div class="mb-3">
                    <label for="tipos_animais" class="form-label">Quais animais você possui?</label>
                    <input type="text" class="form-control bg-secondary text-light" id="tipos_animais" name="tipos_animais" placeholder="Ex: Cachorro, Gato, Pássaro">
                </div>
            </div>

            <div class="mb-3">
                <label for="tempo_sozinho" class="form-label">Quantas horas por dia o animal ficaria sozinho?</label>
                <input type="number" class="form-control bg-secondary text-light" id="tempo_sozinho" name="tempo_sozinho" min="0" placeholder="Ex: 4">
            </div>

              <!-- Foto Pessoal -->
    <h4 class="text-light mt-4">Foto Pessoal (Opcional)</h4>
    {# Bloco para exibir foto atual na edição #}
    {% if request.endpoint == 'editar_adotante_form' and adotante.foto_pessoal_filename %}
    <div class="mb-2">
        <p>Foto Pessoal Atual:</p>
        <img src="{{ url_for('static', filename='uploads/adotantes/' + adotante.foto_pessoal_filename) }}" alt="Foto de {{ adotante.nome_completo }}" class="img-thumbnail" style="max-width: 150px; max-height: 150px; object-fit: cover;">
    </div>
    {% endif %}
    <div class="mb-3">
        <label for="foto_pessoal" class="form-label">{% if request.endpoint == 'editar_adotante_form' and adotante.foto_pessoal_filename %}Substituir Foto Pessoal{% else %}Upload Foto Pessoal{% endif %}</label>
        {# Nome do input é 'foto_pessoal' #}
        <input type="file" class="form-control bg-secondary text-light" id="foto_pessoal" name="foto_pessoal" accept="image/*" onchange="previewImage(event, 'preview-pessoal-image', 'preview-pessoal-container')">
         {% if request.endpoint == 'editar_adotante_form' and adotante.foto_pessoal_filename %}
            <small class="form-text text-muted">Deixe em branco para manter a foto atual.</small>
         {% endif %}
    </div>
    <!-- Preview da NOVA imagem Pessoal -->
    <div id="preview-pessoal-container" class="mb-3" style="display: none;">
        <p>Nova Foto Pessoal (Preview):</p>
        <img id="preview-pessoal-image" src="" class="img-thumbnail" style="max-width: 150px; max-height: 150px; object-fit: cover;">
        <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeImage('foto_pessoal', 'preview-pessoal-image', 'preview-pessoal-container')">Remover Nova Foto</button>
    </div>

            <!-- Foto do Local -->
            <h4 class="text-light mt-4">Foto do Local de Habitação (Opcional)</h4>
            {# Bloco para exibir foto atual na edição #}
            {% if request.endpoint == 'editar_adotante_form' and adotante.foto_local_filename %}
            <div class="mb-2">
                <p>Foto do Local Atual:</p>
                <img src="{{ url_for('static', filename='uploads/adotantes/' + adotante.foto_local_filename) }}" alt="Foto do local" class="img-thumbnail" style="max-width: 150px; max-height: 150px; object-fit: cover;">
            </div>
            {% endif %}
            <div class="mb-3">
                <label for="foto_local" class="form-label">{% if request.endpoint == 'editar_adotante_form' and adotante.foto_local_filename %}Substituir Foto do Local{% else %}Upload Foto do Local{% endif %}</label>
                {# Nome do input é 'foto_local' #}
                <input type="file" class="form-control bg-secondary text-light" id="foto_local" name="foto_local" accept="image/*" onchange="previewImage(event, 'preview-local-image', 'preview-local-container')">
                {% if request.endpoint == 'editar_adotante_form' and adotante.foto_local_filename %}
                    <small class="form-text text-muted">Deixe em branco para manter a foto atual.</small>
                {% endif %}
            </div>
            <!-- Preview da NOVA imagem Local -->
            <div id="preview-local-container" class="mb-3" style="display: none;">
                <p>Nova Foto do Local (Preview):</p>
                <img id="preview-local-image" src="" class="img-thumbnail" style="max-width: 150px; max-height: 150px; object-fit: cover;">
                <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeImage('foto_local', 'preview-local-image', 'preview-local-container')">Remover Nova Foto</button>
            </div>
             
             <div class="d-flex justify-content-between">
                 <button type="submit" class="btn btn-primary">Cadastrar</button>
                 <button type="reset" class="btn btn-secondary" onclick="resetForm()">Limpar</button>
             </div>
            </form> {# Fechamento do form #}
            {# ... (Resto da div container/card) ... #}
            
            {# Scripts JS Atualizados para Múltiplos Previews #}
            {% block scripts %}
            <script>
                function previewImage(event, previewImageId, previewContainerId) {
                    const input = event.target;
                    const previewContainer = document.getElementById(previewContainerId);
                    const previewImage = document.getElementById(previewImageId);
            
                    if (input.files && input.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImage.src = e.target.result;
                            previewContainer.style.display = "block";
                        };
                        reader.readAsDataURL(input.files[0]);
                    } else {
                        previewContainer.style.display = "none";
                        previewImage.src = "";
                    }
                }
            
                function removeImage(inputId, previewImageId, previewContainerId) {
                    document.getElementById(inputId).value = ""; // Limpa o input file
                    document.getElementById(previewImageId).src = "";
                    document.getElementById(previewContainerId).style.display = "none";
                }
            
                //----------------------------------------------------------------------------------------------------
    //Validação do CPF //
    //function validarCPF(cpf) {
    //    fetch(`https://brasilapi.com.br/api/cpf/v1/${cpf}`)
    //            if (response.status === 200) {
    //                document.getElementById('cpf-error').textContent = '';
    //            } else {
     //               document.getElementById('cpf-error').textContent = 'CPF inválido';
    //            }
     //       })
    //        .catch(error => {
    //            document.getElementById('cpf-error').textContent = 'Erro ao validar CPF';
    //        });
    //}
                // Lógica para campos condicionais (igual à anterior)
                function mostrarCamposAnimais() { /* ... */ }
                function esconderCamposAnimais() { /* ... */ }
                document.addEventListener('DOMContentLoaded', function() {
                     if (document.getElementById('tem_outros_animais_sim')?.checked) { // Adicionado '?' para segurança
                        mostrarCamposAnimais();
                     } else {
                         esconderCamposAnimais();
                     }
                });
            
                 // Função buscarEndereco (igual à anterior)
                 function buscarEndereco(cep) { /* ... */ }
            </script>
            {% endblock %} {# <--- FECHAMENTO DO BLOCO scripts #}
            
        {% endblock %} {# <--- FECHAMENTO DO BLOCO content #}